let searchBars=[...document.querySelectorAll(".txt--search")],resultsContainer=(document.querySelectorAll(".btn--feedback").forEach(e=>Object.assign(e,{textContent:Localizer.FEEDBACK_BUTTON_LABEL,onclick:()=>{Dialog.ShowCustom(Localizer.FEEDBACK_TITLE,Localizer.FEEDBACK_DESC,`
			<chip-form>
				<chip-dropdown
					label="${Localizer.FEEDBACK_TYPE_LABEL}"
					required
					id="drpType"
					text="${Localizer.FEEDBACK_TYPE_PLACEHOLDER}">

					<chip-dropdownitem group="${Localizer.FEEDBACK_BUG_GROUP}" value="BUG">${Localizer.FEEDBACK_BUG_LABEL}</chip-dropdownitem>
					<chip-dropdownitem group="${Localizer.FEEDBACK_IMPROVEMENT_GROUP}" value="FEATURE">${Localizer.FEEDBACK_FEATURE_LABEL}</chip-dropdownitem>
					<chip-dropdownitem group="${Localizer.FEEDBACK_IMPROVEMENT_GROUP}" value="IMPROVEMENT">${Localizer.FEEDBACK_IMPROVEMENT_LABEL}</chip-dropdownitem>
					<chip-dropdownitem group="${Localizer.FEEDBACK_CHAT_GROUP}" value="THANKS">${Localizer.FEEDBACK_THANKS_LABEL}</chip-dropdownitem>
				</chip-dropdown>

				<chip-textarea
					rows="12"
					required
					id="txtDetails"
					validation-required="${Localizer.FEEDBACK_DETAILS_VALIDATION_REQUIRED}"
					class="mt-form"
					label="${Localizer.FEEDBACK_DETAILS_LABEL}">
				</chip-textarea>
			</chip-form>
		`,{Size:"md",Scrollable:!0,OnCheckValid:e=>e.querySelector("chip-form").reportValidity(),AffirmativeText:"Submit"}).then(()=>report(drpType.value,"User Submitted Feedback",txtDetails.value))}})),document.getElementById("ctResults"));function search(t){(t=t.trim())&&(resultsContainer.innerHTML='<chip-loading class="d-flex m-auto mt-form--lg" size="xl"></chip-loading>',searchBars.forEach(e=>{e.value=t,e.blur()}),Product.search(t).then(e=>{resultsContainer.innerHTML="",txtResultCount.innerHTML="",txtResultCaption.innerHTML="",txtResultCount.textContent=Localizer.SEARCH_RESULTS_TITLE.replace("{query}",t),txtResultCaption.innerHTML=Localizer.SEARCH_RESULT_CAPTION,e.length?displayResults(e):(resultsContainer.appendChild(document.createElementWithContents("chip-emptyprompt",Localizer.EMPTY_SEARCH_DESC,{heading:Localizer.EMPTY_SEARCH_TITLE,icon:"far fa-cat",id:"epResults",className:"ep--results"})),lblSearchTerm.textContent=t),tabResults.Select(),document.querySelectorAll(".btn--add-product").forEach(e=>e.onclick=()=>Product.add())}))}function displayResults(e){resultsContainer.addItems(e.map(e=>buildResult(e)))}function report(e,t,i,a){Ajax.Post("report",{body:{type:e,title:t,description:i},success:{ok:e=>{a||Dialog.ShowSuccess(Localizer.FEEDBACK_SUCCESS_TITLE,Localizer.FEEDBACK_SUCCESS_DESC)}}})}function buildResult(e){var t=e.getAdvisories(),t=document.createElementWithContents("chip-card",`
			<div class="d-flex flex-column h-100">
				<div class="pc--name gap-md">
					<chip-text
						weight="medium"
						size="h4">
						${e.Name}
					</chip-text>
					<chip-button
						flush
						class="btn--report-product ms-auto"
						button-style="icon"
						tooltip="${Localizer.REPORT_INCORRECT_BUTTON}"
						icon="far fa-flag"
						variation="body">
					</chip-button>
				</div>

				${1<e.Brands.length?`
								<chip-accordionitem
									heading="${e.Brand.Name}"
									class="ai--brand-name mt-xxs">

									<chip-text
										class="mt-form"
										weight="medium"
										size="h5">
										Brand Hierarchy
									</chip-text>

									<div class="brand-hierarchy gx-sm gy-xs mt-sm flex-wrap mb-xs">
										${e.Brands.map(e=>`
												<chip-text>
													${e.Name}
												</chip-text>
											`).join("<chip-icon size='md' icon='far fa-long-arrow-right'></chip-icon>")}
									</div>
								</chip-accordionitem>
							`:`
								<chip-text
									variation="secondary"
									class="mt-xs">
									${e.Brand.Name}
								</chip-text>
							`}

				<div class="responsive-row mb-card gap-sm mt-md">
					${e.Vegan?`<chip-badge tooltip="Completely free of animal-derived ingredients" variation="theme-secondary" badge-style="pill">${Localizer.VEGAN_LABEL}</chip-badge>`:`<chip-badge tooltip="May contain animal-derived or ambiguous ingredients" variation="danger-secondary" badge-style="pill">${Localizer.NOT_VEGAN_LABEL}</chip-badge>`}

					${e.Brand.CrueltyFree?`<chip-badge tooltip="${e.Brand.Name} is a cruelty-free brand" badge-style="pill" variation="theme-secondary">${Localizer.CRUELTYFREE_LABEL}</chip-badge>`:""}

					${e.Brand.BCorp?`<chip-badge tooltip="${e.Brand.Name} is a B Corporation" badge-style="pill" variation="theme-secondary">${Localizer.BCORP_LABEL}</chip-badge>`:""}
				</div>

				${t.length?`
								<chip-text
									weight="medium"
									class="mt-auto"
									icon="far fa-exclamation-circle"
									icon-colour="warning">
									Advisories
								</chip-text>

								<div class="mt-sm">
									${t.trim()}
								</div>
							`:`
								<chip-emptyprompt
									size="sm"
									class="m-auto"
									icon="fas fa-paw"
									heading="Looks good!">
									Based on brand information, it doesn't look like there's anything to worry about, nice!
								</chip-emptyprompt>
							`}
			</div>
		`,{image:"/cdn-cgi/image/width=200,format=auto/products/"+e.Image,hideBlur:!0});return t.classList.add("cd--product"),t.querySelector(".btn--report-product").onclick=()=>e.reportIncorrect(),t}searchBars.forEach(t=>Object.assign(t,{onsuffixclick:()=>search(t.value),onkeydown:e=>{"Enter"!==e.key||e.repeat||search(t.value)}})),window.btnBack?.addEventListener("click",()=>tabHero.Select());