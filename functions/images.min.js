export async function onRequest(e){const{request:t,env:n,params:a,waitUntil:r}=e,o=a?.image||"default.png",s=new URL(t.url),c=new Request(s.toString(),t),u=caches.default;let i=await u.match(c);if(i)return i;try{const e=await n.R2_BUCKET.get(o);if(!e)return new Response("Image not found",{status:404});const t=await e.arrayBuffer();return i=new Response(t,{headers:{"Content-Type":e.httpMetadata.contentType||"application/octet-stream","Cache-Control":"public, max-age=86400"}}),r(u.put(c,i.clone())),i}catch(e){return console.error(e),new Response("Error fetching image",{status:500})}}