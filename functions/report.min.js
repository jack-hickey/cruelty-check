export async function onRequest(e){if("POST"!==e.request.method)return new Response("Method Not Allowed",{status:405});let t=await e.request.json(),s="Unknown",n=e.request.headers.get("user-agent").toLowerCase(),i=[{name:"Edge",regex:/edg/},{name:"Opera",regex:/(opera|opr)/},{name:"Vivaldi",regex:/vivaldi/},{name:"Brave",regex:/brave/},{name:"Chrome",regex:/chrome/,exclude:/(edg|opr|vivaldi|brave)/},{name:"Firefox",regex:/firefox/},{name:"Safari",regex:/safari/,exclude:/chrome|chromium|crios/},{name:"Samsung Internet",regex:/samsungbrowser/},{name:"Internet Explorer",regex:/msie|trident/}].find(e=>e.regex.test(n)&&(!e.exclude||!e.exclude.test(n)))??"Unknown";if(/Windows NT 10\.0/i.test(n)?s="Windows 10/11":/Windows NT 6\.3/i.test(n)?s="Windows 8.1":/Windows NT 6\.2/i.test(n)?s="Windows 8":/Windows NT 6\.1/i.test(n)?s="Windows 7":/Windows Phone|IEMobile/i.test(n)?s="Windows Phone":/Macintosh|Mac OS X/i.test(n)?s="macOS":/CrOS/i.test(n)?s="ChromeOS":/Linux/i.test(n)?s="Linux":/Android/i.test(n)?s="Android":/iPhone|iPad|iPod/i.test(n)&&(s="iOS"),!t.title||!t.description||!t.type)return new Response("Bad Request",{status:400});const o=`### Details\n${t.description}\n### Source\nBrowser: ${i}\nOperating System: ${s}`,r=await fetch(`https://api.github.com/repos/${e.env.GITHUB_REPO}/issues`,{method:"POST",headers:{Authorization:`token ${e.env.GITHUB_TOKEN}`,Accept:"application/vnd.github+json","User-Agent":"cloudflare-pages-form"},body:JSON.stringify({title:t.title,body:o,labels:[t.type.toLowerCase()],assignee:"jack-hickey"})});return r.ok?new Response("",{status:200}):new Response(await r.text(),{status:r.status})}